:toc:
:imagesdir: ./images
== Vmware中ubuntu系统vmwaretools工具的安装
声明：此方法适合初学小白使用，高手请自动略过：

出这个文档的意义：1.自己搞了好久没搞定，出现了很多问题，总是安装失败，百度了好久

2.通过自己的实践和百度，找到了方法。给自己提个醒。

3.帮助更多和我一样的小白解决问题！

=== 第一步：点击你们的虚拟机名字，右击的，点击安装vmware tools
image:vmware tools-setting.png[vmware tools-setting.png]

=== 第二步：复制vmwaretool安装包到home目录

在此页面的下方会有一个安装vmware tools的提示，点击进入，在ubuntu系统桌面上面创建一个光盘的图标，表明将这个安装文件已经放进来了
image:vmware tools-tar.png[vmware tools-tar.png]
双击点进去这个光盘，里面有一个这个文件 [点击并拖拽以移动] ，为了好操作，你直接把这个文件复制或者剪切到主目录下面，也就是Home目录，如下图所示：
image:vmware tools-home.png[vmware tools-home.png]

=== 第三步：在当前这个目录下打开终端

执行解压目录，解压vmwaretool压缩包

注意一下，如果你不是root用户登录的，在此命令之前加 sudo,防止出错，这里统一加上去

sudo tar vzxf VMwareTools-10.1.6-5214329.tar.gz

注意：这里的vmwaretools版本根据自己的型号来定，可以不需要手动打字

直接找到这个文件 [点击并拖拽以移动] 鼠标右击，点击属性，里面有名字，直接复制这个文件名就可以了

然后，你就会看到一大堆代码

=== 第四步：切换到 vmware-tools-distrib目录

（这里有两种方法：

1.在刚刚执行解压命令的终端 输入 cd vmware-tools-distrib/

2.找到你刚刚解压的文件夹，就是在你复制的那个主目录下 ，会有一个解压包 [点击并拖拽以移动]
image:vmware tools-distrib.png[vmware tools-distrib.png]
右击，打开终端，就到了这个文件目录下面了）

=== 最后：输入命令：sudo ./vmware-install.pl 安装

sudo ./vmware-install.pl

然后，你需要枯燥了按下yes和回车按钮，一直按，知道最后，会出现一个命令，you can enjoy it!

恭喜你，安装成功了。

重启虚拟机，点击全屏，如果能显示全屏，则安装成功了，也可以从Windows复制文件去linux上了！

== Nginx

=== 搭建直播服务

==== 服务端环境搭建

环境：Ubuntu

[NOTE]
====
建议使用 Chrome 浏览器访问，否则可能出现图片无法正常显示的问题。
====

首先，更换源为阿里云镜像

https://opsx.alibaba.com/mirror

在 Ubuntu 栏目的帮助中，找到对应版本的修改提示。

1. 进入用户 home 目录（可选）

  cd ~

2. 下载 `nginx` 安装包，以 `1.16.0` 版本为例：
  
  wget http://nginx.org/download/nginx-1.16.0.tar.gz

3. 下载 `nginx-rtmp-module` 模块，以 `1.2.1` 为例：
  
  wget https://github.com/arut/nginx-rtmp-module/archive/v1.2.1.tar.gz

4. 解压文件

  tar xvf nginx-1.16.0.tar.gz
  tar xvf v1.2.1.tar.gz

5. 安装依赖

  // 如果安装过程中出错，仍旧提示缺少依赖，根据提示安装相关依赖即可
  sudo apt install gcc make zlib1g-dev libpcre3 libpcre3-dev openssl libssl-dev

6. 编译并安装文件

  // 请将 module 的路径改为你本地的实际路径
  sudo ./configure --add-module=~/nginx-rtmp-module && sudo make && sudo make install

7. 创建 `live_rtmp.conf` 配置文件

  sudo touch /usr/local/nginx/conf/live_rtmp.conf

8. 编辑配置文件，内容请参阅 link:./example/live_rtmp.conf[live_rtmp.conf]

9. 复制 `stat.xsl` 文件至指定目录，与配置文件中 `location /stat.xsl` 中 `root` 路径一致

  cp ~/nginx-rtmp-module/stat.xsl /usr/local/nginx/html/

10. 验证配置文件正确性

  /usr/local/nginx/sbin/nginx -t  -c /usr/local/nginx/conf/live_rtmp.conf

11. 首次启动 `nginx`

  sudo /usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/live_rtmp.conf

12. 打开浏览器，输入 `localhost:8080/stat` ，查看有无结果

==== 客户端OBS推流

image::obs-add-origin.png[obs-add-origin.png]

image::obs-add-origin-type-image.png[obs-add-origin.png]

image::obs-setting-stream.png[obs-add-origin.png]


==== 客户端VLC拉流

image::vlc-open-network-address.png[vlc-open-network-address.png]

image::vlc-open-network-address-config.png[vlc-open-network-address-config.png]

*参考*：

https://yq.aliyun.com/articles/626492

https://www.cnblogs.com/monjeo/p/8492357.html

== Git

=== 上传本地代码至Github

为什么要传到 Github 中呢，因为，你用过就会知道有多么美妙了！（By: 陈鑫）

1. 在 Github 中创建一个和自己项目名字一样的仓库

  eg: 我自己创建的就是一个文件夹 demo

2. 打开 Git bash

  在自己本地的项目 demo 文件夹中，在空白处，使用鼠标右键选择 `Git bash here`

3. 初始化 Git 仓库

  git init

4. 添加远程仓库地址

  git remote add origin https://github.com/WhiteLie1/demo.git    // 请使用你自己的仓库地址

5. 添加文件至暂存区

  git add -A    // 添加所有文件

6. 提交暂存区的修改（提交至本地）

  git commit -m "Init repo"

7. 将代码推送到远程仓库的 master （主）分支

  git push -u origin master

当远程数据仓库和本体的关联以后就可以进行日常的操作了。

首先呢，一定是在你项目当前的目录下打开 `Git bash here` ,然后你需要做的是：

[source, bash]
----
// 添加所有修改过或新增的文件
git add .

// 查看文件状态
git status

// 提交并说明修改情况
git commit -m "修改了某文件"

/ 推送到远程仓库
git push
----

=== 无法推送到远程分支

*问题背景：*

新建远程仓库时，初始化了 `README.md` 。

在本地项目文件下，使用 `git init` 初始化了仓库，准备推送到远程仓库，但是会提示错误，比如：`Updates were rejected because the remote contains work that you do
hint: not have locally` 。

[source, bash]
----
$ git push --set-upstream origin master

To gitee.com:xiexingchao/git-command-test.git
 ! [rejected]        master -> master (fetch first)
error: failed to push some refs to 'git@gitee.com:xiexingchao/git-command-test.git'
hint: Updates were rejected because the remote contains work that you do
hint: not have locally. This is usually caused by another repository pushing
hint: to the same ref. You may want to first integrate the remote changes
hint: (e.g., 'git pull ...') before pushing again.
hint: See the 'Note about fast-forwards' in 'git push --help' for details.
----

本地与远程分支不一致，其实就是本地少了个 `README.md`，但是又多了一些其它文件。

按照提示，执行 `git pull` 命令，获取远程分支信息。

[source, bash]
----
$ git pull
warning: no common commits
remote: Enumerating objects: 4, done.
remote: Counting objects: 100% (4/4), done.
remote: Compressing objects: 100% (4/4), done.
remote: Total 4 (delta 0), reused 0 (delta 0)
Unpacking objects: 100% (4/4), done.
From gitee.com:xiexingchao/git-command-test
 * [new branch]      master     -> origin/master
There is no tracking information for the current branch.
Please specify which branch you want to merge with.
See git-pull(1) for details.

git pull <remote> <branch>

If you wish to set tracking information for this branch you can do so with:

git branch --set-upstream-to=origin/<branch> master
----

获取了远程分支信息后，需要对远程的 `master` 和本地的 `master` 分支进行一个合并，以解决它们之间的冲突。

[source, bash]
----
$ git merge origin/master master
fatal: refusing to merge unrelated histories
----

合并时依旧有问题，它提示无法合并不相关的历史。

我们可以在官方文档对 `git merge` 命令的介绍中找到这个选项：

.--allow-unrelated-histories
By default, git merge command refuses to merge histories that do not share a common ancestor. This option can be used to override this safety when merging histories of two projects that started their lives independently. As that is a very rare occasion, no configuration variable to enable this by default exists and will not be added.

`git` 默认不允许合并那些没有公共祖先节点的历史。而我们的远程分支和本地分支都是起点（祖先节点）。所以使用该选项来覆写 `git` 的规则，即破例允许这样合并。

[source, bash]
----
$ git merge origin/master master --allow-unrelated-histories

Merge made by the 'recursive' strategy.
 README.en.md | 36 ++++++++++++++++++++++++++++++++++++
 README.md    | 39 +++++++++++++++++++++++++++++++++++++++
 2 files changed, 75 insertions(+)
 create mode 100644 README.en.md
 create mode 100644 README.md
----

== Node.js

=== 更换npm下载源

`npm install` 时巨慢无比，这时可以把下载源换成淘宝的。

[source,bash]
----
npm config set registry https://registry.npm.taobao.org
----

淘宝NPM源官网 -  https://npm.taobao.org

=== Think.js框架

*热更新*

`Think.js` 框架支持热更新操作，保存文件后会自动重新部署，即刻生效，你可以在终端输出中看到相关信息。

而在 `java` 中，针对 `controller` 也就是 `servlet` 的修改操作，需要 `Redelploy` 或者 `Restart` 来使得更改生效，整个过程耗时要长一些。

*数据库安全*

为了防止数据库密码暴露在公开场合，可以将密码设置为环境变量，然后在 `adapter.js` 中使用 `process.env['variable_name']` 调用系统环境变量。

*踩坑*

* 返回数据库数据时，切记使用 `await` 将异步数据库操作改成同步操作，否则无法获取预期的返回值。

[source, js]
----
findAction() {
  let user = this.model().where({ id: id }).find()
  this.json(user)
}
// response => {}

async findAction() {
  let user = await this.model().where({ id: id }).find()
  this.json(user)
}
// response => { user: { ... } }
----

* 更新 `json` 字段的值时，应当传入字符串形式的值。

[source, js]
----
// wrong
model.where( { id： 1 } ).update('{ key: value }')

// true
model.where( { id： 1 } ).update({ key: value })
----

*简单下载功能*

参阅： link:./example/file.js[file.js]

== 数据库

=== MySQL

==== 安装

以Windows下zip格式的文件（版本5.7）安装为例：

1. 打开powershell（管理员模式）

  使用快捷键 WIN + X => A

2. 进入mysql目录

  cd 'mysql_dir/bin'

3. 执行初始化操作

  ./mysqld --initialize

4. 查看初始化生成的默认密码

  在搜索栏中输入 *.err，密码就在这个文件中（一般是最后一行，比如：'A temporary password......'）

5. 启动mysql

  ./mysqld --console

6. 添加环境变量（方便使用mysql相关命令）

  在path变量中新增'/mysql_dir/bin'

7. 登陆

  mysql -uroot -p

8. 更改密码

  alter user 'root'@localhost identified by 'new password'

9. 中文乱码

  * sqlyog 中取消勾选表属性中隐藏语言选项（最右）

      选择字符集为utf8,核对为utf8_general_ci

  * 查看数据库编码

      show variables like "%char%"

  * 设置character_set_client,character_set_connection,character_set_results的方法

      set names utf8

  * 设置character_set_database,character_set_server为utf8的方法

      找到数据库安装目录下my.ini文件

      [mysqld]下增加character-set-server=utf8

      [client]下增default-character-set=utf8

      [mysql]下增default-character-set=utf8

  * 重启服务

      net stop mysql

      net start mysql

==== 插入中文数据时报错

创建表时指定 `utf8` 编码即可。

[source, mysql]
----
create table user (name varchar(20)) default charset=utf8;
----

官方文档 - https://dev.mysql.com/doc/refman/5.7/en/windows-install-archive.html

==== 命令快速参考
创建表

----
// 一般形式
CREATE TABLE table_name (id int primary key auto_increment ... )

// 含外键
CREATE TABLE order (
  id int primary key auto_increment,
  user_id int,
  vendor_id int
  foreign key (user_id) references user(id),
  foreign key (vendor_id) references vendor(id)
)
----

更新字段

  UPDATE user SET name = 'Jack' WHERE id = 1;

删除记录

  DELETE FROM user where id = 1;

删除表

  DROP TABLE user;

更改字段定义

  ALTER TABLE user MODIFY nickname varchar(100) default 'newUser';



== Web开发

推荐网站：

https://developer.mozilla.org/zh-CN[Mozillia Developer Network]

=== JavaScript

当键值的名称一致时，可采用简写形式。

[source, js]
----
let userID = 1
let data1 = { userID: userID }    // { userID: 1 }
let data2 = { userID }    // 简写形式，效果与上面相同
----

在反引号（`）中引用变量

[source, js]
----
let str1 = 'world'
let str2 = 'hello ' + `${str1}`    // result: 'hello world'
----

运算符

`===` 表示等于
`!==` 表示不等于

=== HTTP请求调试工具

客户端软件：Postman

浏览器插件：RESTED（支持Chrome，Firefox）

== 美化

Windows 下 CMD 和 PowerShell 推荐使用 http://www.downcc.com/font/17200.html[Microsoft Yahei Mono] 字体。

Git bash 可以使用 https://github.com/tonsky/FiraCode/releases[Fira Code] 字体。

VS Code 下推荐 Material Theme，Atom One Dark 之类的主题。

== 提升自我修养

https://github.com/ryanhanwu/How-To-Ask-Questions-The-Smart-Way/blob/master/README-zh_CN.md[《提问的智慧》]
